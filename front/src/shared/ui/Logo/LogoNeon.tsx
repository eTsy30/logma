// components/Logo/AnimatedBulb.tsx
'use client';

import { useState, useEffect, useCallback } from 'react';
import s from './LogoNeon.module.scss';

interface AnimatedBulbProps {
  className?: string;
  width?: number;
  autoFlicker?: boolean;
}

export const LogoNeon = ({
  className,
  width = 200,
  autoFlicker = true,
}: AnimatedBulbProps) => {
  const [isOn, setIsOn] = useState(true);
  const [isFlickering, setIsFlickering] = useState(false);

  const flicker = useCallback(() => {
    setIsFlickering(true);
    const pattern = [0, 1, 0, 0, 1, 0, 1, 0]; // Мерцание старой лампы
    let step = 0;

    const interval = setInterval(() => {
      setIsOn(pattern[step] === 1);
      step++;
      if (step >= pattern.length) {
        clearInterval(interval);
        setIsOn(true);
        setIsFlickering(false);
      }
    }, 60);
  }, []);

  useEffect(() => {
    if (!autoFlicker) return;

    const timer = setInterval(
      () => {
        if (Math.random() > 0.6 && !isFlickering) {
          flicker();
        }
      },
      4000 + Math.random() * 6000,
    );

    return () => clearInterval(timer);
  }, [flicker, isFlickering, autoFlicker]);

  const handleClick = () => {
    if (!isFlickering) {
      isOn ? flicker() : setIsOn(true);
    }
  };

  const height = (width / 3265.42) * 2578.64;

  return (
    <svg
      viewBox="0 0 3265.42 2578.64"
      width={width}
      height={height}
      className={`${s.bulb} ${className || ''} ${isOn ? s.on : s.off} ${isFlickering ? s.flickering : ''}`}
      onClick={handleClick}
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        {/* Glow фильтр */}
        <filter id="bulbGlow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="100" result="blur" />
          <feFlood floodColor="#ffe066" floodOpacity="0.6" />
          <feComposite in2="blur" operator="in" />
          <feMerge>
            <feMergeNode />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

        {/* Внутреннее свечение */}
        <radialGradient id="innerGlow" cx="50%" cy="40%" r="50%">
          <stop offset="0%" stopColor="#fff9c4" stopOpacity="0.8" />
          <stop offset="100%" stopColor="#ffe066" stopOpacity="0" />
        </radialGradient>
      </defs>

      {/* Фон (прозрачный) */}
      <path
        className={s.bg}
        d="M 0 0 L 3265.421875 0 L 3265.421875 2578.640625 L 0 2578.640625 L 0 0"
      />

      {/* Цоколь - нижняя часть */}
      <path
        className={s.baseBottom}
        d="M 1541.621094 349.46875 C 1541.621094 345.011719 1545.238281 341.390625 1549.699219 341.390625 L 1831.339844 341.390625 C 1833.488281 341.390625 1835.539062 342.238281 1837.058594 343.75 C 1838.570312 345.269531 1839.429688 347.328125 1839.429688 349.46875 L 1839.429688 582.960938 C 1839.429688 585.109375 1838.570312 587.160156 1837.058594 588.679688 C 1835.539062 590.191406 1833.488281 591.050781 1831.339844 591.050781 L 1549.699219 591.050781 C 1545.238281 591.050781 1541.621094 587.429688 1541.621094 582.960938 L 1541.621094 349.46875"
      />

      {/* Цоколь - левая часть */}
      <path
        className={s.baseLeft}
        d="M 1541.621094 344.089844 C 1541.621094 342.589844 1542.828125 341.390625 1544.320312 341.390625 L 1638.359375 341.390625 C 1639.851562 341.390625 1641.058594 342.589844 1641.058594 344.089844 L 1641.058594 588.351562 C 1641.058594 589.839844 1639.851562 591.050781 1638.359375 591.050781 L 1544.320312 591.050781 C 1542.828125 591.050781 1541.621094 589.839844 1541.621094 588.351562 L 1541.621094 344.089844"
      />

      {/* Цоколь - правая часть */}
      <path
        className={s.baseRight}
        d="M 1741.441406 344.050781 C 1741.441406 342.578125 1742.628906 341.390625 1744.101562 341.390625 L 1836.78125 341.390625 C 1838.238281 341.390625 1839.441406 342.578125 1839.441406 344.050781 L 1839.441406 588.378906 C 1839.441406 589.851562 1838.238281 591.050781 1836.78125 591.050781 L 1744.101562 591.050781 C 1742.628906 591.050781 1741.441406 589.851562 1741.441406 588.378906 L 1741.441406 344.050781"
      />

      {/* Основное свечение (круг) */}
      <path
        className={s.glow}
        d="M 1051.539062 1697.996094 C 1051.539062 1347.320312 1335.820312 1063.039062 1686.488281 1063.039062 C 2037.171875 1063.039062 2321.449219 1347.320312 2321.449219 1697.996094 C 2321.449219 2048.675781 2037.171875 2332.953125 1686.488281 2332.953125 C 1335.820312 2332.953125 1051.539062 2048.675781 1051.539062 1697.996094"
      />

      {/* Внутреннее свечение (овал) */}
      <path
        className={s.inner}
        d="M 1612.160156 1036.878906 C 1612.160156 1032.46875 1613.910156 1028.238281 1617.03125 1025.121094 C 1620.148438 1022 1624.378906 1020.238281 1628.800781 1020.238281 L 1698.460938 1020.238281 C 1707.648438 1020.238281 1715.101562 1027.691406 1715.101562 1036.878906 L 1715.101562 1368.128906 C 1715.101562 1377.320312 1707.648438 1384.761719 1698.460938 1384.761719 L 1628.800781 1384.761719 C 1624.378906 1384.761719 1620.148438 1383.011719 1617.03125 1379.890625 C 1613.910156 1376.769531 1612.160156 1372.539062 1612.160156 1368.128906 L 1612.160156 1036.878906"
      />

      {/* Корпус лампы - основной */}
      <path
        className={s.bodyMain}
        d="M 1375.480469 468.160156 C 1375.480469 463.75 1377.230469 459.519531 1380.351562 456.398438 C 1383.46875 453.28125 1387.699219 451.519531 1392.121094 451.519531 L 1971.78125 451.519531 C 1976.191406 451.519531 1980.421875 453.28125 1983.539062 456.398438 C 1986.660156 459.519531 1988.421875 463.75 1988.421875 468.160156 L 1988.421875 1135.738281 C 1988.421875 1140.148438 1986.660156 1144.378906 1983.539062 1147.5 C 1980.421875 1150.621094 1976.191406 1152.371094 1971.78125 1152.371094 L 1392.121094 1152.371094 C 1387.699219 1152.371094 1383.46875 1150.621094 1380.351562 1147.5 C 1377.230469 1144.378906 1375.480469 1140.148438 1375.480469 1135.738281 L 1375.480469 468.160156"
      />

      {/* Ниточка накаливания */}
      <path
        className={s.filament}
        d="M 1575.511719 1360.390625 C 1590.320312 1401.851562 1571.308594 1457.210938 1555.671875 1506.960938 C 1539.390625 1558.761719 1521.898438 1616.015625 1517.660156 1664.640625 C 1515.890625 1679.246094 1514.660156 1694.882812 1513.929688 1710.800781 C 1512.5 1741.878906 1512.851562 1775.398438 1515.191406 1804.445312 C 1518.230469 1850.058594 1529.089844 1895.339844 1538.550781 1941.953125 C 1547.449219 1985.820312 1555.410156 2031.757812 1538.929688 2066.464844 C 1522.300781 2101.144531 1478.640625 2124.863281 1409.980469 2112.09375 C 1343.261719 2099.683594 1254.960938 2050.011719 1192.679688 1946.632812 C 1150.558594 1875.851562 1125.5 1787.621094 1130.359375 1691.777344 C 1132.789062 1644.246094 1142.398438 1598.453125 1157.949219 1555.828125 C 1212.699219 1409.808594 1327.328125 1329.371094 1415.03125 1308.121094 C 1505.761719 1286.128906 1560.78125 1318.691406 1575.671875 1360.390625"
      />

      {/* Корпус - левая грань */}
      <path
        className={s.bodyLeft}
        d="M 1375.480469 457.078125 C 1375.480469 455.601562 1376.058594 454.191406 1377.109375 453.148438 C 1378.148438 452.109375 1379.558594 451.519531 1381.03125 451.519531 L 1574.589844 451.519531 C 1576.058594 451.519531 1577.46875 452.109375 1578.511719 453.148438 C 1579.558594 454.191406 1580.140625 455.601562 1580.140625 457.078125 L 1580.140625 1146.820312 C 1580.140625 1148.289062 1579.558594 1149.699219 1578.511719 1150.75 C 1577.46875 1151.789062 1576.058594 1152.371094 1574.589844 1152.371094 L 1381.03125 1152.371094 C 1379.558594 1152.371094 1378.148438 1151.789062 1377.109375 1150.75 C 1376.058594 1149.699219 1375.480469 1148.289062 1375.480469 1146.820312 L 1375.480469 457.078125"
      />

      {/* Корпус - правая грань */}
      <path
        className={s.bodyRight}
        d="M 1786.730469 457 C 1786.730469 453.96875 1789.179688 451.519531 1792.210938 451.519531 L 1982.949219 451.519531 C 1984.398438 451.519531 1985.800781 452.101562 1986.820312 453.128906 C 1987.851562 454.148438 1988.429688 455.550781 1988.429688 457 L 1988.429688 1146.898438 C 1988.429688 1148.351562 1987.851562 1149.738281 1986.820312 1150.769531 C 1985.800781 1151.800781 1984.398438 1152.371094 1982.949219 1152.371094 L 1792.210938 1152.371094 C 1789.179688 1152.371094 1786.730469 1149.921875 1786.730469 1146.898438 L 1786.730469 457"
      />
    </svg>
  );
};
